<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Leaflet: Make a web map!</title>
	<style>
		html, body{ color: #333; font: 20px/24px "Open Sans", sans-serif; margin: 0; background-color: #d1c9b8;}
		#container{ width: 900px; margin: auto;}
		.map{ width: 100%; height: 500px;}
		h1, h2{
			text-align: center;
			color: black;
		}
		h1{
			font-size: 60px;
		}
		h2{
			font-size: 36px;
			margin-top: 40px;
		}
		a{
			background-color: #bef;
			color: #333;
			text-decoration: none;
		}
		a:hover{
			text-decoration: underline;
		}
		.leaflet-container a{
			background-color: transparent;
		}
		pre{
			background-color: #eee;
			padding: 0 15px;
			overflow: auto;
		}
		code{ color: black;}

		code em, code em span, code em .token.operator{
			font-style: normal;
			font-weight: bold;
			background: #d0d0d0;
		}

	</style>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
	<link rel="stylesheet" href="MarkerCluster.css" />
  <link rel="stylesheet" href="prism.css">
	<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
	<script src="leaflet.markercluster.js"></script>
	<script src="jquery-2.1.1.min.js"></script>
  <script src="prism.js"></script>
</head>

<body>
<div id="container">
	<h1>Leaflet: Make a web map!</h1>
	<p>So. You want to make a web map. Don't worry; it's easy! This is an introduction to web maps using  Leaflet. It was written by Andy Woodruff and Ryan Mullins for <a href="http://maptimeboston.github.io" target="_blank">Maptime Boston</a> and adapted by RK Aranas for <a href="http://dge.upd.edu.ph/philgeos2014/foss4g-ph-2014/" target"_blank">FOSS4G-PH 2014</a>. Let's begin!</p>
	<h2 id="section1">What is Leaflet?</h2>
		<p>
			<a href="http://leafletjs.com" target="_blank">Leaflet</a> is an open-source JavaScript library for interactive web maps. It's lightweight, simple, and flexible, and is probably the most popular open-source mapping library at the moment. Leaflet is developed by <a href="http://agafonkin.com/en/" target="_blank">Vladimir Agafonkin</a> (currently of MapBox) and other contributors.
		</p>
		<p><strong>What Leaflet does:</strong> "Slippy" maps with tiled base layers, panning and zooming, and feature layers that you supply. It handles various basic tasks like converting data to map layers and mouse interactions, and it's easy to extend with <a href="http://leafletjs.com/plugins.html" target="_blank">plugins</a>. It will also work well across most types of devices. See <a href="http://maptime.github.io/anatomy-of-a-web-map/" target="_blank">Anatomy of a Web Map</a> for an introduction to the most common kinds of web maps, which is what Leaflet is good for.
		</p>
		<p><strong>What Leaflet does not do:</strong> Provide any data for you! Leaflet is a framework for showing and interacting with map data, but it's up to you to provide that data, including a basemap. Leaflet is also not GIS, although it can be combined with tools like <a href="http://cartodb.com" target="_blank">CartoDB</a> for GIS-like capabilities. If you need total freedom of form, interaction, transitions, and map projections, consider working with something like <a href="http://d3js.org" target="_blank">D3</a>.</p>
		<p><strong>How this tutorial works:</strong> It's structured around examples that progressively build upon one another, starting from scratch and ending with slightly advanced techniques. It assumes a basic knowledge of HTML and JavaScript, or at the very least assumes the will to tinker with the code to better understand what it doesâ€”and how to use it for your own work. It won't explain every little object or array, but will contain plenty of links. Many code blocks show only a snippet of code, highlighting the changes over previous examples.</p>
		<p><strong>BEFORE YOU START!</strong>
			<ol>
				<li>You'll want a proper text editor. We recommend <a href="http://www.sublimetext.com/" target="_blank">Sublime Text</a>. Or Notepad. I'm joking. Please don't use Notepad.
				</li>
				<li>If you want to follow along on your own computer, your maps will need be on a local web server. Easy ways of doing this include running Python's <a href="http://www.pythonforbeginners.com/modules-in-python/how-to-use-simplehttpserver/" target="_blank">SimpleHTTPServer</a> in your map directory, installing <a href="http://www.mamp.info/en/" target="_blank">MAMP</a> (for Mac), or installing <a href="http://www.wampserver.com/en/" target="_blank">WampServer</a> (for Windows).
				</li>
			</ol>
		</p>
	<h2 id="section2">This is a simple Leaflet map. A few lines of code.</h2>
	<div class="map" id="map0"></div>
	<a class="standalone" href="http://bl.ocks.org/rukku/44344eeacf6b55365fc9" target="_blank"></a>
	<h2 id="section2">Let's make a map!</h2>

	<p>The simple map above requires only a few things:
		<ol>
			<li>An html page</li>
			<li>The Leaflet CSS styles</li>
			<li>The Leaflet JavaScript library</li>
			<li>A <code>&lt;div&gt;</code> element to hold the map</li>
			<li>A <code>height</code> style specified for the map div.</li>
			<li>A short script to create the map in that <code>&lt;div&gt;</code></li>
		</ol>
	</p>
	<pre><code class="language-markup">
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;A Leaflet map!&lt;/title&gt;
  &lt;link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/&gt;
  &lt;script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"&gt;&lt;/script&gt;
  &lt;style&gt;
    #map{ height: 100% }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;div id="map"&gt;&lt;/div&gt;

  &lt;script&gt;

  // initialize the map
  var map = L.map('map').setView([14.654343736166062,  121.0664176940918], 16);

  // load a tile layer
  L.tileLayer('http://{s}.tiles.mapbox.com/v3/openplans.map-g4j0dszr/{z}/{x}/{y}.png',
    {
      attribution: 'Tiles by &lt;a href="http://mapbox.com"&gt;DevelopmentSeed&lt;/a&gt;, Data by &lt;a href="http://openstreetmap.org"&gt;OpenStreetMap Contributors&lt;/a&gt;',
      maxZoom: 17,
      minZoom: 9
    }).addTo(map);

  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
	</code></pre>

	<h2 id="section4">Easy! Now let's map our own data!</h2>

	<div id="map2" class="map"></div>
	<a class="standalone" href="http://bl.ocks.org/awoodruff/1dc36a658a2e24e01b12" target="_blank"></a>

	<pre><code class="language-markup">
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;A Leaflet map!&lt;/title&gt;
  &lt;link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/&gt;
  &lt;script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"&gt;&lt;/script&gt;
   OOO &lt;script src="jquery-2.1.1.min.js"&gt;&lt;/script&gt; CCC 
  &lt;style&gt;
    #map{ height: 100% }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;div id="map"&gt;&lt;/div&gt;

  &lt;script&gt;

  // initialize the map
  var map = L.map('map').setView([14.654343736166062,  121.0664176940918], 16);

  // load a tile layer
  L.tileLayer('http://{s}.tiles.mapbox.com/v3/openplans.map-g4j0dszr/{z}/{x}/{y}.png',
    {
      attribution: 'Tiles by &lt;a href="http://mapc.org"&gt;MAPC&lt;/a&gt;, Data by &lt;a href="http://mass.gov/mgis"&gt;MassGIS&lt;/a&gt;',
      maxZoom: 17,
      minZoom: 9
    }).addTo(map);
 OOO 
  // load GeoJSON from an external file
  $.getJSON("precincts.geojson",function(data){
    // add GeoJSON layer to the map once the file is loaded
    L.geoJson(data).addTo(map);
  });
 CCC 
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
	</code></pre>

<h2 id="section5">Add some style</h2>


<div id="map3" class="map"></div>
<a class="standalone" href="http://bl.ocks.org/awoodruff/803c310c871b3b5cc199" target="_blank"></a>

<pre><code class="language-javascript">
$.getJSON("precincts.geojson",function(data){
   OOO var precinctIcon = L.icon({
    iconUrl: 'precinct.png',
    iconSize: [30,70]
  }); CCC 
  L.geoJson(data OOO ,{
    pointToLayer: function(feature,latlng){
	  return L.marker(latlng,{icon: precinctIcon});
    }
  } CCC ).addTo(map);
});
</code></pre>

<h2 id="section6">Interaction</h2>
<div id="map4" class="map"></div>
<a class="standalone" href="http://bl.ocks.org/awoodruff/2488ee1fdf0cf063904e" target="_blank"></a>
<pre><code class="language-javascript">
pointToLayer: function(feature,latlng){
   OOO var marker = L.marker(latlng,{icon: precinctIcon});
  marker.bindPopup(feature.properties.name);
  return marker; CCC 
}
</code></pre>

<h2 id="section7">Polygons</h2>
<div id="map5" class="map"></div>
<pre><code class="language-javascript">
 OOO $.getJSON("buildings.geojson",function(buildingData){
  L.geoJson( buildingData ).addTo(map);
}); CCC 

$.getJSON("precincts.geojson",function(data){
  var precinctIcon = L.icon({
    iconUrl: 'precinct.png',
    iconSize: [30,70]
  });
  L.geoJson(data,{
    pointToLayer: function(feature,latlng){
      var marker = L.marker(latlng,{icon: precinctIcon});
      marker.bindPopup(feature.properties.name);
      return marker;
    }
  }).addTo(map);
});
</code></pre>

<h2 id="section8">Thematic styles</h2>

<div id="map6" class="map"></div>
<a class="standalone" href="http://bl.ocks.org/awoodruff/3ce5d735126a56dfff94" target="_blank"></a>
<pre><code class="language-javascript">
$.getJSON("buildings.geojson",function(buildingData){
  L.geoJson( buildingData OOO , {
    style: function(feature){
      var fillColor,
          buildingtype = feature.properties.type;
      if ( buildingtype == "school") fillColor = "#006837";
      else fillColor = "black";  // no data
      return { color: "#999", weight: 1, fillColor: fillColor, fillOpacity: .6 };
    },
    onEachFeature: function( feature, layer ){
      layer.bindPopup( "&lt;strong&gt;" + feature.properties.type + "&lt;/strong&gt;")
    }
  } CCC ).addTo(map);
});
</code></pre>

<h2 id="section9">Plug in and thin out</h2>

<div id="map7" class="map"></div>
<a class="standalone" href="http://bl.ocks.org/awoodruff/5de3553bb1f1b0c5f90d" target="_blank"></a>
<pre><code class="language-markup">
&lt;link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/&gt;
 OOO &lt;link rel="stylesheet" href="MarkerCluster.css"/&gt; CCC 
&lt;script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"&gt;&lt;/script&gt;
 OOO &lt;script src="leaflet.markercluster.js"&gt;&lt;/script&gt; CCC 
&lt;script src="jquery-2.1.1.min.js"&gt;&lt;/script&gt;

...

&lt;script&gt;

...

 OOO var precincts =  CCC L.geoJson(data,{
  pointToLayer: function(feature,latlng){
    var marker = L.marker(latlng,{icon: precinctIcon});
    marker.bindPopup(feature.properties.name);
    return marker;
  }
});
 OOO var clusters = L.markerClusterGroup();
clusters.addLayer(precincts);
map.addLayer(clusters); CCC 

...

&lt;/script&gt;
</code></pre>

<h2>Go forth</h2>

	<ul>
		<li><a href="http://leafletjs.com/examples.html" target="_blank">Tutorials on the main Leaflet site.</a></li>
		<li><a href="http://leafletjs.com/reference.html" target="_blank">Leaflet API reference</a></li>
		<li><a href="http://leaflet-extras.github.io/leaflet-providers/preview/" target="_blank">Previews and URLs for many basemap options</a></li>
		<li><a href="https://www.mapbox.com/mapbox.js/api/v2.1.0/" target="_blank">Mapbox.js, a library that builds on Leaflet and integrates with Mapbox maps</a></li>
		<li><a href="https://speakerdeck.com/mourner/future-of-leaflet" target="_blank">The Future of Leaflet</a> (version 1.0 is coming!)</li>
		<li><a href="http://vimeo.com/106112939" target="_blank">How Simplicity Will Save GIS</a>, a talk by Vladimir Agafonkin at FOSS4G 2014, demonstrating the thinking behind Leaflet</li>
		<li><a href="https://github.com/RyanMullins/Geog461W.SP2014.Labs" target="_blank">Dynamic Cartography lab assignments</a> from Penn State, covering many techniques and technologies, including Leaflet.</li>
		<li><a href="https://github.com/mapbox/leaflet-omnivore" target="_blank">leaflet-omnivore</a> is a particularly handy plugin for loading common data formats such as CSV.</li>
		<li><a href="https://github.com/geografa/foss4g2014-workshops/blob/master/Leaflet-and-Mapbox-JavaScript-API-Fundamentals.md" target="_blank">Leaflet and Mapbox JavaScript API Fundamentals</a> workshop by Rafa Gutierrez</li>
		<li><a href="http://mapschool.io/" target="_blank">mapschool.io</a>, an on going project explaining map fundamentals</li>
		<li>Texts such as <a href="http://www.amazon.com/Web-Cartography-Design-Interactive-Devices/dp/1439876223" target="_blank">Web Cartography: Map Design for Interactive and Mobile Devices</a> can be good for understanding good map design principles.</a>
	</ul>
</p>
</div>
<script>

$(window).load(function(){
	var h = $("code").each(function(){
		var h = $(this).html().replace(/ OOO /g, "<em>").replace( / CCC /g, "</em>");
		$(this).html(h);
	});
	
})

//

var mapDivs = document.getElementsByClassName("map"),
	maps = [];

for ( var i=0; i<mapDivs.length; i++ ){
	initializeMap( mapDivs[i].id );
}

function initializeMap(id){
	var map = L.map(id, {scrollWheelZoom: false}).setView([14.654343736166062,  121.0664176940918], 16);
	L.tileLayer('http://{s}.tiles.mapbox.com/v3/openplans.map-g4j0dszr/{z}/{x}/{y}.png', {
	    attribution: 'Map tiles &copy; Development Seed and Data from <a href="http://openstreetmap.org">OpenStreetMap</a> contributors,',
	    maxZoom: 17,
	    minZoom: 9
	}).addTo(map);
	maps.push(map);

	// specific code for each map
	switch (id){
		case "map1":
		L.tileLayer('http://{s}.tiles.mapbox.com/v3/openplans.map-g4j0dszr/{z}/{x}/{y}.png', {
		    maxZoom: 17,
		    minZoom: 9
		}).addTo(map);
		break;

		case "map2":
		$.getJSON("precincts.geojson",function(data){
			L.geoJson(data).addTo(map);
		})
		break;

		case "map3":
		$.getJSON("precincts.geojson",function(data){
			var precinctIcon = L.icon({
				iconUrl: 'precinct.png',
				iconSize: [30,70]
			});
			L.geoJson(data,{
				pointToLayer: function(feature,latlng){
					return L.marker(latlng,{icon: precinctIcon});
				}
			}).addTo(map);
		})
		break;

		case "map4":
		$.getJSON("precincts.geojson",function(data){
			var precinctIcon = L.icon({
				iconUrl: 'precinct.png',
				iconSize: [30,70]
			});
			L.geoJson(data,{
				pointToLayer: function(feature,latlng){
					var marker = L.marker(latlng,{icon: precinctIcon});
					marker.bindPopup(feature.properties.name);
					return marker;
				}
			}).addTo(map);
		})
		break;

		case "map5":
		$.getJSON("buildings.geojson",function(buildingData){
			L.geoJson( buildingData ).addTo(map);
		});
		$.getJSON("precincts.geojson",function(data){
			var precinctIcon = L.icon({
				iconUrl: 'precinct.png',
				iconSize: [30,70]
			});
			L.geoJson(data,{
				pointToLayer: function(feature,latlng){
					var marker = L.marker(latlng,{icon: precinctIcon});
					marker.bindPopup(feature.properties.name);
					return marker;
				}
			}).addTo(map);
		});
		break;

		case "map6":
		$.getJSON("buildings.geojson",function(buildingData){
			L.geoJson( buildingData, {
				style: function(feature){
					var fillColor,
						buildingtype = feature.properties.type;
					if ( buildingtype == "school" ) fillColor = "#006837";
					else if ( buildingtype == "college" ) fillColor = "#ffffcc";
					else fillColor = "black";
					return { color: "#999", weight: 1, fillColor: fillColor, fillOpacity: .6 };
				},
				onEachFeature: function( feature, layer ){
					layer.bindPopup( "<strong>" + feature.properties.name + "</strong><br/>" + feature.properties.type )
				}
			}).addTo(map);
		});
		$.getJSON("precincts.geojson",function(data){
			var precinctIcon = L.icon({
				iconUrl: 'precinct.png',
				iconSize: [30,70]
			});
			L.geoJson(data,{
				pointToLayer: function(feature,latlng){
					var marker = L.marker(latlng,{icon: precinctIcon});
					marker.bindPopup(feature.properties.name);
					return marker;
				}
			}).addTo(map);
		});
		break;

		case "map7":
		$.getJSON("buildings.geojson",function(buildingData){
			L.geoJson( buildingData, {
				style: function(feature){
					var fillColor,
						buildingtype = feature.properties.type;
					if ( buildingtype == "school" ) fillColor = "#006837";
					else if ( buildingtype == "college" ) fillColor = "#ffffcc";
					else fillColor = "black";
					return { color: "#999", weight: 1, fillColor: fillColor, fillOpacity: .6 };
				},
				onEachFeature: function( feature, layer ){
					layer.bindPopup( "<strong>" + feature.properties.name + "</strong><br/>" + feature.properties.type + " rats per square mile" )
				}
			}).addTo(map);
		});
		$.getJSON("precincts.geojson",function(data){
			var precinctIcon = L.icon({
				iconUrl: 'precinct.png',
				iconSize: [30,70]
			});
			var clusters = L.markerClusterGroup();
			var precincts = L.geoJson(data,{
				pointToLayer: function(feature,latlng){
					var marker = L.marker(latlng,{icon: precinctIcon});
					marker.bindPopup(feature.properties.name);
					return marker;
				}
			});
			clusters.addLayer(precincts);
			map.addLayer(clusters);
		});
		break;
	}

}
</script>

</body>
</html>
